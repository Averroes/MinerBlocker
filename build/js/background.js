"use strict";function _toConsumableArray(c){if(Array.isArray(c)){for(var b=0,a=Array(c.length);b<c.length;b++){a[b]=c[b]}return a}return Array.from(c)}var _extends=Object.assign||function(c){for(var b=1;b<arguments.length;b++){var a=arguments[b];for(var d in a){Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d])}}return c};var defaultConfig={toggle:true,whitelist:[]};var config,totalBlocked=0;chrome.storage.local.get(function(a){config=_extends({},defaultConfig,a.config);totalBlocked=a.totalBlocked||0;config.toggle||changeToggleIcon(!1)});var saveConfig=function(){chrome.storage.local.set({config:config})},incBlocked=function(b){var a=b.tabId;if(!siteBlocked[a]){siteBlocked[a]=0}siteBlocked[a]++;totalBlocked++;chrome.storage.local.set({totalBlocked:totalBlocked})},updateBadge=function(a,b){if(b&&siteBlocked[a]){chrome.browserAction.setBadgeText({text:""+siteBlocked[a],tabId:a});chrome.browserAction.setBadgeBackgroundColor({tabId:a,color:"#ff0000"})}},changeToggleIcon=function(a,b){chrome.browserAction.setIcon({tabId:b,path:"img/"+(a?"logo_enabled":"logo_disabled")+".png"})},getDomain=function(b){var a=b.match(/:\/\/(.[^/]+)/);return a?a[1]:""},getTimestamp=function(){return Math.floor(Date.now()/1000)},isDomainWhitelisted=function(c){if(!c){return false}var a=config.whitelist.find(function(d){return d.domain===c});var b=!!a&&(!(0!==a.expiration&&a.expiration<=getTimestamp())||(removeDomainFromWhitelist(c),!1));return b},addDomainToWhitelist=function(b,a){b&&(isDomainWhitelisted(b)||(config.whitelist=[].concat(_toConsumableArray(config.whitelist),[{domain:b,expiration:0===a?0:getTimestamp()+60*a}]),saveConfig()))},removeDomainFromWhitelist=function(a){a&&(config.whitelist=config.whitelist.filter(function(b){return b.domain!==a}),saveConfig())},domains=[],siteBlocked={};chrome.tabs.onUpdated.addListener(function(b,a,d){domains[b]=getDomain(d.url);var c=isDomainWhitelisted(domains[b]);changeToggleIcon(!c,b);updateBadge(b,!c)}),chrome.tabs.onRemoved.addListener(function(a){delete domains[a];delete siteBlocked[a]});var urlsList=["https://coin-hive.com/lib*","https://coin-hive.com/captcha*","wss://*.coin-hive.com/proxy*","https://jsecoin.com/server*","https://*.jsecoin.com/server*","*://coinhive.com/lib*","*://coin-hive.com/lib*","*://coinhive.com/captcha*","*://coin-hive.com/captcha*","wss://*.coinhive.com/proxy*","wss://*.coin-hive.com/proxy*","*://jsecoin.com/server*","*://*.jsecoin.com/server*","*://static.reasedoper.pw/*","*://mataharirama.xyz/*","*://listat.biz/*","*://lmodr.biz/*","*://minecrunch.co/web/*","*://minemytraffic.com/*","*://crypto-loot.com/lib*","wss://*.crypto-loot.com/proxy*"];chrome.webRequest.onBeforeRequest.addListener(function(a){if(config.toggle){if(isDomainWhitelisted(domains[a.tabId])){return{cancel:false}}else{incBlocked(a);return{cancel:true}}}else{return{cancel:false}}},{urls:urlsList},["blocking"]);chrome.runtime.onMessage.addListener(function(a,b,c){switch(a.type){case"GET_STATE":c({whitelisted:isDomainWhitelisted(domains[a.tabId]),toggle:config.toggle,siteBlocked:siteBlocked[a.tabId]||0,totalBlocked:totalBlocked||0});break;case"WHITELIST":if(a.whitelisted){removeDomainFromWhitelist(domains[a.tabId],a.time)}else{addDomainToWhitelist(domains[a.tabId],a.time)}changeToggleIcon(!a.whitelisted,a.tabId);c(!a.whitelisted)}});